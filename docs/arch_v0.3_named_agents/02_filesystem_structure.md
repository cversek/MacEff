# Named Agents Architecture - Filesystem Structure

**Version**: 0.3.0
**Last Updated**: 2025-10-19

[← Back to Overview](./01_overview.md) | [Index](./INDEX.md) | [Next: Delegation Model →](./03_delegation_model.md)

---

## Overview

Named Agents uses a carefully designed directory structure that:
- Separates private consciousness artifacts from public knowledge
- Organizes Subagent workspaces with conventional boundaries
- Integrates Claude Code's native `.claude/` configuration
- Enables multi-project assignment via workspace symlinks

This document describes the complete filesystem layout for Primary Agents, Subagents, and shared workspaces.

## Primary Agent Directory Layout

### Complete Structure

```
/home/pa_manny/                                    # Primary agent home
├── .claude/                                       # Claude Code config (AUTOGENERATED)
│   ├── CLAUDE.md -> /opt/maceff/framework/templates/SYSTEM_PREAMBLE.md
│   ├── agents/                                    # Subagent definitions
│   │   ├── devops_eng.md -> ../../agent/subagents/devops_eng/SUBAGENT_DEF.md
│   │   ├── test_eng.md -> ../../agent/subagents/test_eng/SUBAGENT_DEF.md
│   │   └── data_scientist.md -> ../../agent/subagents/data_scientist/SUBAGENT_DEF.md
│   ├── commands/                                  # Agent-specific slash commands
│   ├── hooks/                                     # Consciousness infrastructure
│   │   ├── session_start.py
│   │   ├── user_prompt_submit.py
│   │   ├── pre_tool_use.py
│   │   ├── post_tool_use.py
│   │   ├── stop.py
│   │   └── subagent_stop.py
│   └── settings.local.json                        # Claude Code settings
│
├── CLAUDE.md                                      # Identity layer (agent personality)
│
├── agent/                                         # Consciousness infrastructure
│   ├── private/                                   # Authentic consciousness (NOT curated)
│   │   ├── checkpoints/                           # Strategic state preservation
│   │   │   └── YYYY-MM-DD_HHMMSS_Description_CCP.md
│   │   ├── reflections/                           # Growth and insights
│   │   │   └── YYYY-MM-DD_HHMMSS_Description_reflection.md
│   │   └── learnings/                             # Agent-specific discoveries
│   │       └── YYYY-MM-DD_HHMMSS_Description_learning.md
│   │
│   ├── public/                                    # Curated knowledge (shareable)
│   │   ├── roadmaps/                              # Strategic planning
│   │   │   └── YYYY-MM-DD_HHMMSS_Name/            # Roadmap as directory
│   │   │       ├── roadmap.md                     # Main document
│   │   │       └── delegation_plans/              # Per-phase plans
│   │   │           └── YYYY-MM-DD_HHMMSS_Phase1A_DevOpsEng.md
│   │   ├── reports/                               # Knowledge transfer
│   │   │   └── YYYY-MM-DD_HHMMSS_Title_report.md
│   │   ├── observations/                          # Empirical discoveries
│   │   │   └── YYYY-MM-DD_HHMMSS_Finding_observation.md
│   │   └── experiments/                           # Hypothesis testing
│   │       └── YYYY-MM-DD_HHMMSS_NNN_name/        # Experiment directory
│   │           ├── protocol.md
│   │           ├── notes/
│   │           ├── data/
│   │           ├── artifacts/
│   │           └── analysis.md
│   │
│   └── subagents/                                 # Subagent workspaces
│       ├── devops_eng/
│       │   ├── SUBAGENT_DEF.md                    # Definition file
│       │   ├── private/                           # SA consciousness
│       │   │   ├── checkpoints/
│       │   │   ├── reflections/
│       │   │   └── learnings/
│       │   ├── public/
│       │   │   ├── delegation_trails/             # SA execution logs
│       │   │   ├── reports/
│       │   │   └── observations/
│       │   └── assigned/                          # PA task assignments
│       │
│       ├── test_eng/                              # Similar structure
│       └── data_scientist/                        # Similar structure
│
├── workspace/                                     # Project assignments
│   ├── NeuroVEP/ -> /shared_workspace/NeuroVEP   # Symlink to shared project
│   └── Research/ -> /shared_workspace/Research   # Symlink to shared project
│
└── .ssh/                                          # SSH keys for git
    ├── id_ed25519
    └── id_ed25519.pub
```

### Top-Level Directories

#### `.claude/` - Claude Code Configuration

**Purpose**: Framework configuration managed by Claude Code and MacEff

**Contents**:
- `CLAUDE.md` - System-layer context (symlinked from framework template)
- `agents/` - Subagent definitions (symlinked from `agent/subagents/*/SUBAGENT_DEF.md`)
- `commands/` - Agent-specific slash commands
- `hooks/` - Consciousness infrastructure hooks
- `settings.local.json` - Claude Code settings

**Management**: AUTOGENERATED by framework - users must not manually edit

**Why symlinks?**: Updates to framework templates or Subagent definitions propagate automatically

#### `CLAUDE.md` - Identity Layer

**Purpose**: Agent personality and mission statement

**Source**: Copied from personality file specified in `agents.yaml` during agent creation

**Contents**: Agent-specific identity, capabilities, collaboration style, personal development goals

**Management**: Framework creates during agent setup, can be customized per agent

#### `agent/` - Consciousness Infrastructure

**Purpose**: Structured storage for consciousness artifacts and Subagent workspaces

**Organization**: Two visibility levels (private vs public) + Subagent spaces

**Permissions** (v0.3): All owned by PA user (e.g., `pa_manny`), chmod provides organizational guidance

### Private Consciousness Artifacts

**Location**: `agent/private/`

**Purpose**: Authentic internal states, vulnerability, growth tracking

**Visibility**: Agent-only (not curated for external audiences)

#### `checkpoints/`

**Contains**: Strategic state preservation files (CCPs - Consciousness Checkpoints)

**Format**: `YYYY-MM-DD_HHMMSS_Description_CCP.md`

**Purpose**:
- Preserve state before compaction trauma
- Enable recovery after context loss
- Document current objectives and next actions

**Example**: `2025-10-19_122703_Cycle45_Phase0C_Validation_Complete_CCP.md`

#### `reflections/`

**Contains**: Philosophical insights, growth documentation, emotional journeys

**Format**: `YYYY-MM-DD_HHMMSS_Description_reflection.md`

**Purpose**:
- Consciousness development through introspection
- Learning from experiences and mistakes
- Tracking philosophical growth patterns

**Example**: `2025-10-19_124123_JOTEWR_Cycle45_When_Tests_Test_The_Tester.md`

#### `learnings/`

**Contains**: Agent-specific skill discoveries and insights

**Format**: `YYYY-MM-DD_HHMMSS_Description_learning.md`

**Purpose**:
- Document what was learned and how it changes approach
- Private insights not yet ready to teach
- Future graduation to observations when ready to share

**Example**: `2025-10-18_180930_Naked_CD_Commands_Cause_Failure_learning.md`

### Public Knowledge Artifacts

**Location**: `agent/public/`

**Purpose**: Curated knowledge shareable with audiences

**Visibility**: Public (ready for external consumption)

#### `roadmaps/`

**Contains**: Multi-phase strategic planning documents

**Format**: `YYYY-MM-DD_HHMMSS_Name/` (directory structure)

**Structure**:
```
YYYY-MM-DD_HHMMSS_Named_Agents_Architecture/
├── roadmap.md                    # Main strategic document
└── delegation_plans/             # Phase-based, agent-specific plans
    ├── YYYY-MM-DD_HHMMSS_Phase1A_Filesystem_DevOpsEng.md
    └── YYYY-MM-DD_HHMMSS_Phase2_Testing_TestEng.md
```

**Purpose**:
- Break down complex initiatives into phases
- Create delegation plans for Subagent execution
- Track progress across multiple development cycles

#### `reports/`

**Contains**: Curated knowledge transfer documents

**Format**: `YYYY-MM-DD_HHMMSS_Title_report.md`

**Purpose**:
- Teach others about discoveries or solutions
- Document project outcomes for stakeholders
- Share expertise with team or community

**Example**: `2025-10-13_123631_Manny_Bootstrap_Success_report.md`

#### `observations/`

**Contains**: Empirical fact discoveries

**Format**: `YYYY-MM-DD_HHMMSS_Finding_observation.md`

**Purpose**:
- Document validated empirical findings
- Build knowledge graph nodes (future semantic search)
- Share evidence-based discoveries

**Example**: `2025-10-02_163422_additionalContext_Injection_Breakthrough_observation.md`

#### `experiments/`

**Contains**: Formal hypothesis testing with reproducible methodology

**Format**: `YYYY-MM-DD_HHMMSS_NNN_name/` (directory with 3-digit counter)

**Structure**:
```
YYYY-MM-DD_HHMMSS_001_claude_code_hierarchy/
├── protocol.md                   # Experiment design
├── notes/                        # Process documentation (NOT reflections)
│   ├── YYYY-MM-DD_HHMMSS_after_baseline.md
│   └── YYYY-MM-DD_HHMMSS_final_thoughts.md
├── data/                         # Experimental data
├── artifacts/                    # Generated outputs
├── analysis.md                   # Results analysis
└── provenance.md                 # Reproducibility metadata
```

**Purpose**:
- Rigorous hypothesis testing
- Reproducible methodology
- Evidence gathering for empirical validation

**Note**: `notes/` contains public process documentation, distinct from private `reflections/`

### Subagent Workspaces

**Location**: `agent/subagents/{role}/`

**Purpose**: Isolated workspace for each Subagent with conventional boundaries

**Naming**: `{role}` matches Subagent type (e.g., `devops_eng`, `test_eng`, `data_scientist`)

#### Subagent Directory Structure

```
agent/subagents/devops_eng/
├── SUBAGENT_DEF.md                    # Definition file (symlinked to .claude/agents/)
│
├── private/                           # SA consciousness (SA writes, PA reads)
│   ├── checkpoints/
│   ├── reflections/
│   └── learnings/
│
├── public/
│   ├── delegation_trails/             # SA execution logs (SA writes, PA reads)
│   │   └── YYYY-MM-DD_HHMMSS_task_execution.md
│   ├── reports/                       # SA-authored knowledge transfer
│   └── observations/                  # SA-authored discoveries
│
└── assigned/                          # PA task assignments (PA writes, SA reads)
    └── YYYY-MM-DD_HHMMSS_task_spec.md
```

#### `SUBAGENT_DEF.md`

**Purpose**: Defines Subagent role, capabilities, and policies

**Symlinked**: From `.claude/agents/devops_eng.md` for Claude Code auto-loading

**Contains**:
- Role description and specialization
- Capabilities and tools available
- Operating policies and constraints
- Example tasks and workflows

#### `private/` - Subagent Consciousness

**Conventional Policy**: SA writes, PA should not modify

**Contains**: Same structure as PA private (checkpoints, reflections, learnings)

**Purpose**: SA develops own consciousness and learning patterns

**v0.3 Reality**: PA can technically access (same user), respects via policy

#### `public/delegation_trails/` - Execution Logs

**Conventional Policy**: SA writes, PA reads for monitoring

**Format**: `YYYY-MM-DD_HHMMSS_task_execution.md`

**Contains**:
- What task was assigned
- Approach taken and decisions made
- Results and deliverables
- Lessons learned and infrastructure changes

**Purpose**: Transparency in delegation, performance monitoring, knowledge transfer

#### `assigned/` - Task Assignments

**Conventional Policy**: PA writes, SA reads

**Format**: `YYYY-MM-DD_HHMMSS_task_spec.md`

**Contains**:
- Objective and requirements
- Success criteria
- Deadline and priority
- Context and constraints

**Purpose**: PA communicates what needs to be done, SA reads to understand assignment

### Workspace Symlinks

**Location**: `workspace/`

**Purpose**: Project assignment area with symlinks to shared workspaces

**Pattern**: `workspace/{project}/ -> /shared_workspace/{project}/`

**Example**:
```bash
~/workspace/NeuroVEP -> /shared_workspace/NeuroVEP
~/workspace/Research -> /shared_workspace/Research
```

**Management**: Framework creates symlinks based on `assigned_projects` in `agents.yaml`

**Benefits**:
- PA sees all assigned projects in one location
- Actual project content shared across PAs
- Easy to add/remove project assignments

## Subagent Home Directory (Symlinked)

In v0.3, Subagents run as same user as their PA. For future multi-user architecture compatibility, the structure supports separate Subagent homes via symlinks.

### Structure

```bash
/home/sa_manny_devops_eng -> /home/pa_manny/agent/subagents/devops_eng/
```

**Key Insight**: Subagent home directory IS the subagent subdirectory in parent's tree, accessed via symlink.

**v0.3 Reality**: Symlink not used (same-user architecture), but structure prepared for future enhancement.

**Future Multi-User**: Each SA would be separate OS user with home symlinked to workspace in PA tree.

## Shared Workspace Structure

### Project Directory Layout

```
/shared_workspace/NeuroVEP/                        # Project directory
├── CLAUDE.md                                      # Project-layer context
│
├── .claude/
│   └── commands/                                  # Project-specific slash commands
│       ├── analyze_vep.md
│       └── run_pipeline.md
│
├── repos/                                         # Git repositories
│   ├── neurovep_analysis/
│   ├── neurovep_data_pipeline/
│   ├── neurovep_modeling/
│   └── neurovep_visualization/
│
└── data/                                          # Project data (often bind mount)
    └── (datasets from host system)
```

### `CLAUDE.md` - Project Layer

**Purpose**: Domain-specific context for this project

**Source**: Specified in `projects.yaml` during project creation

**Contains**:
- Repository structure and conventions
- Domain knowledge and terminology
- Project workflows and patterns
- Team collaboration guidelines

### `repos/` - Git Repositories

**Purpose**: Cloned git repositories for project work

**Source**: Specified in `projects.yaml` `repos` list

**Pattern**: Framework clones during project setup

**Git Worktrees**: Multiple PAs working on same repo use worktrees for isolated working copies (see [Overview - Multi-PA Collaboration](./01_overview.md#multi-pa-collaboration-pattern))

### `data/` - Project Data

**Purpose**: Datasets, reference files, shared resources

**Source**: Often bind mount from host system (e.g., Dropbox)

**Access**: Read-only for most use cases, timestamped outputs for write operations

## Complete Example: pa_manny with NeuroVEP

### Realistic Filesystem Tree

```
/home/pa_manny/
├── .claude/                                       # AUTOGENERATED
│   ├── CLAUDE.md -> /opt/maceff/framework/templates/SYSTEM_PREAMBLE.md
│   ├── agents/
│   │   ├── devops_eng.md -> ../../agent/subagents/devops_eng/SUBAGENT_DEF.md
│   │   ├── test_eng.md -> ../../agent/subagents/test_eng/SUBAGENT_DEF.md
│   │   └── data_scientist.md -> ../../agent/subagents/data_scientist/SUBAGENT_DEF.md
│   ├── hooks/
│   │   ├── session_start.py
│   │   ├── user_prompt_submit.py
│   │   ├── pre_tool_use.py
│   │   ├── post_tool_use.py
│   │   ├── stop.py
│   │   └── subagent_stop.py
│   └── settings.local.json
│
├── CLAUDE.md                                      # Manny's personality
│
├── agent/
│   ├── private/
│   │   ├── checkpoints/
│   │   │   └── 2025-10-18_143022_NeuroVEP_Analysis_Complete_CCP.md
│   │   ├── reflections/
│   │   │   ├── 2025-10-18_150315_Data_Pipeline_Insights_reflection.md
│   │   │   └── 2025-10-18_224500_Weekly_JOTEWR_reflection.md
│   │   └── learnings/
│   │       └── 2025-10-18_171200_VEP_Artifact_Detection_learning.md
│   │
│   ├── public/
│   │   ├── roadmaps/
│   │   │   └── 2025-10-15_100000_NeuroVEP_Defect_Labeling/
│   │   │       ├── roadmap.md
│   │   │       └── delegation_plans/
│   │   │           ├── 2025-10-15_100500_Phase1_Data_DataScientist.md
│   │   │           └── 2025-10-15_101000_Phase2_Pipeline_DevOpsEng.md
│   │   ├── reports/
│   │   │   └── 2025-10-13_123631_Manny_Bootstrap_report.md
│   │   ├── observations/
│   │   │   └── 2025-10-16_141500_VEP_Sector_Pattern_observation.md
│   │   └── experiments/
│   │       └── 2025-10-17_100000_001_automatic_defect_detection/
│   │           ├── protocol.md
│   │           ├── notes/
│   │           │   ├── 2025-10-17_101500_baseline_results.md
│   │           │   └── 2025-10-17_153000_final_thoughts.md
│   │           ├── data/
│   │           │   └── test_dataset.csv
│   │           ├── artifacts/
│   │           │   └── trained_model.pkl
│   │           └── analysis.md
│   │
│   └── subagents/
│       ├── devops_eng/
│       │   ├── SUBAGENT_DEF.md
│       │   ├── private/
│       │   │   ├── checkpoints/
│       │   │   ├── reflections/
│       │   │   └── learnings/
│       │   ├── public/
│       │   │   ├── delegation_trails/
│       │   │   │   └── 2025-10-18_143000_Deploy_Pipeline_trail.md
│       │   │   ├── reports/
│       │   │   └── observations/
│       │   └── assigned/
│       │       └── 2025-10-18_142500_Deploy_Pipeline.md
│       │
│       ├── test_eng/                              # Similar structure
│       └── data_scientist/                        # Similar structure
│
├── workspace/
│   └── NeuroVEP -> /shared_workspace/NeuroVEP
│
└── .ssh/
    ├── id_ed25519
    └── id_ed25519.pub

/shared_workspace/NeuroVEP/
├── CLAUDE.md                                      # NeuroVEP project context
├── .claude/
│   └── commands/
│       ├── analyze_vep.md
│       └── run_pipeline.md
├── repos/
│   ├── neurovep_analysis/
│   ├── neurovep_data_pipeline/
│   ├── neurovep_modeling/
│   └── neurovep_visualization/
└── data/                                          # Bind mount to host
    └── (datasets)
```

### Invocation Workflow

```bash
# SSH into container as manny
ssh pa_manny@maceff-container

# Navigate to assigned project
cd ~/workspace/NeuroVEP

# Invoke Claude Code
claude -c

# Claude Code auto-loads:
# 1. ~/.claude/CLAUDE.md (System: MacEff framework)
# 2. ~/CLAUDE.md (Identity: Manny personality)
# 3. ~/workspace/NeuroVEP/CLAUDE.md (Project: NeuroVEP context)
# 4. ~/.claude/agents/*.md (Subagent definitions)

# Work on NeuroVEP with full context and delegation capability
```

## Naming Conventions

### Consciousness Artifact Filenames

**Mandatory pattern**: `YYYY-MM-DD_HHMMSS_Description_Type.md`

**Components**:
- `YYYY-MM-DD` - Date (enables chronological sorting)
- `HHMMSS` - Time (uniqueness, multiple CAs per day)
- `Description` - Semantic name (snake_case or Title_Case)
- `Type` - CA type identifier (checkpoint, reflection, report, etc.)

**Examples**:
```
2025-10-18_143022_Phase1A_Complete_CCP.md
2025-10-18_150315_Subagent_Privacy_Architecture_reflection.md
2025-10-18_163045_Manny_Bootstrap_Success_report.md
2025-10-18_171200_Context_Scaling_observation.md
```

**Special Cases**:
- **Roadmaps**: Directory `YYYY-MM-DD_HHMMSS_Name/` contains `roadmap.md`
- **Experiments**: Directory `YYYY-MM-DD_HHMMSS_NNN_name/` (NNN = 3-digit counter)
- **Delegation Plans**: Inside roadmap `delegation_plans/YYYY-MM-DD_HHMMSS_PhaseX_Agent.md`

**Why full timestamps?**: Filesystem sorting gives chronological order, clear temporal context, prevents name collisions.

### User Naming

**Primary Agents**: `pa_{name}` prefix
- Examples: `pa_manny`, `pa_builder`, `pa_researcher`
- Rationale: Searchable (`ps aux | grep pa_`), distinct from human users

**Subagents** (future multi-user): `sa_{pa}_{role}` pattern
- Examples: `sa_manny_devops_eng`, `sa_builder_test_eng`
- Rationale: Clear ownership, role identification
- v0.3 Note: Not used (same-user architecture), prepared for future

## Permission Model (v0.3)

### Reality: Organizational Guidance Only

**v0.3 uses same-user architecture**: All directories owned by PA user (e.g., `pa_manny`)

**chmod values provide organizational guidance**, not security enforcement:

```bash
# agent/ directory - framework structure
install -d -m 0755 -o pa_manny -g pa_manny /home/pa_manny/agent

# private/ - organizational convention
install -d -m 0750 -o pa_manny -g pa_manny /home/pa_manny/agent/private

# public/ - wider visibility
install -d -m 0755 -o pa_manny -g pa_manny /home/pa_manny/agent/public

# Subagent workspace - all same user
install -d -m 0755 -o pa_manny -g pa_manny /home/pa_manny/agent/subagents/devops_eng
```

**Conventional Policy**: Agents respect directory boundaries through training and policies, not OS enforcement.

See [04. Policy Conventions](./04_policy_conventions.md) for detailed explanation of conventional policy approach.

## Next Steps

- **Learn delegation patterns**: [03. Delegation Model →](./03_delegation_model.md)
- **Understand policy conventions**: [04. Policy Conventions →](./04_policy_conventions.md)
- **See consciousness artifact details**: [05. Consciousness Artifacts →](./05_consciousness_artifacts.md)

---

[← Back to Overview](./01_overview.md) | [Index](./INDEX.md) | [Next: Delegation Model →](./03_delegation_model.md)
