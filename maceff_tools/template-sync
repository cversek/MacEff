#!/usr/bin/env bash
set -euo pipefail

# template-sync: Copy version-controlled templates to .maceff/framework/
# Bind mount makes changes immediately visible in container (no docker cp needed)

REPO_ROOT="$(cd "$(dirname "$0")"/../.. && pwd)"
SRC_DIR="$REPO_ROOT/templates"
DEST_DIR="$REPO_ROOT/.maceff/framework/templates"

if [[ ! -d "$SRC_DIR" ]]; then
  echo "error: source templates directory not found: $SRC_DIR" >&2
  echo "       (looking for version-controlled templates in repo)" >&2
  exit 1
fi

if [[ ! -d "$REPO_ROOT/.maceff/framework" ]]; then
  echo "error: .maceff/framework/ not initialized" >&2
  echo "       run: make init" >&2
  exit 1
fi

echo "Syncing templates from version control to framework..."
echo "  Source: templates/"
echo "  Dest:   .maceff/framework/templates/"

# Create destination directory
mkdir -p "$DEST_DIR"

# Copy files from version control to .maceff/framework/
rsync -av --delete "$SRC_DIR/" "$DEST_DIR/"

echo "âœ… Templates synced (bind mount makes them immediately visible in container)"
ls -1 "$DEST_DIR/"
